<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ“Š ä¸‰ç­–ç•¥æ¯”è¼ƒç³»çµ±</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#e94560">
    <meta name="description" content="èœ˜è››ç¶² vs æ°¸é åšå¤š vs è²·é€²æŒæœ‰ - æŠ•è³‡ç­–ç•¥å›æ¸¬æ¯”è¼ƒç³»çµ±">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ç­–ç•¥æ¯”è¼ƒ">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.svg">

    <!-- Fonts & Scripts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Inter:wght@400;600;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans TC', 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            color: #ffffff;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 30px 0;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, #e94560, #00d26a, #4a9fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #888;
            font-size: 1.1rem;
        }

        /* åƒæ•¸å€ */
        .params-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .params-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .param-group {
            display: flex;
            flex-direction: column;
        }

        .param-group label {
            color: #aaa;
            font-size: 0.9rem;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .param-group input,
        .param-group select {
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 1rem;
            font-family: inherit;
        }

        .param-group input:focus,
        .param-group select:focus {
            outline: none;
            border-color: #4a9fff;
            box-shadow: 0 0 0 3px rgba(74, 159, 255, 0.2);
        }

        .run-btn {
            background: linear-gradient(135deg, #e94560 0%, #ff6b6b 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 20px auto 0;
            font-family: inherit;
        }

        .run-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(233, 69, 96, 0.4);
        }

        /* ç­–ç•¥å¡ç‰‡ */
        .strategies-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .strategy-card {
            border-radius: 20px;
            padding: 25px;
            position: relative;
            overflow: hidden;
        }

        .strategy-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
        }

        .card-spider {
            background: linear-gradient(135deg, rgba(233, 69, 96, 0.15) 0%, rgba(233, 69, 96, 0.05) 100%);
            border: 1px solid rgba(233, 69, 96, 0.3);
        }

        .card-spider::before {
            background: #e94560;
        }

        .card-forever {
            background: linear-gradient(135deg, rgba(0, 210, 106, 0.15) 0%, rgba(0, 210, 106, 0.05) 100%);
            border: 1px solid rgba(0, 210, 106, 0.3);
        }

        .card-forever::before {
            background: #00d26a;
        }

        .card-buyhold {
            background: linear-gradient(135deg, rgba(74, 159, 255, 0.15) 0%, rgba(74, 159, 255, 0.05) 100%);
            border: 1px solid rgba(74, 159, 255, 0.3);
        }

        .card-buyhold::before {
            background: #4a9fff;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .card-icon {
            font-size: 2rem;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .card-subtitle {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .metric {
            margin-bottom: 15px;
        }

        .metric-label {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 5px;
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            font-family: 'Inter', sans-serif;
        }

        .metric-value.positive {
            color: #00d26a;
        }

        .metric-value.negative {
            color: #e94560;
        }

        .metric-value.neutral {
            color: #4a9fff;
        }

        .card-footer {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            color: #666;
        }

        /* åœ–è¡¨å€ */
        .chart-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
        }

        #chart {
            width: 100%;
            height: 450px;
        }

        /* è¡¨æ ¼ */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1rem;
        }

        th,
        td {
            padding: 15px 20px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        th {
            background: rgba(255, 255, 255, 0.05);
            font-weight: 600;
            color: #aaa;
            font-size: 0.9rem;
        }

        td {
            font-weight: 500;
        }

        tr:hover td {
            background: rgba(255, 255, 255, 0.03);
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 50px;
            color: #888;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: #e94560;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* èªªæ˜å€ */
        .info-section {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 30px;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-card h4 {
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .info-card p {
            color: #888;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        @media (max-width: 900px) {
            .strategies-grid {
                grid-template-columns: 1fr;
            }

            .info-section {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8rem;
            }

            .subtitle {
                font-size: 0.95rem;
            }

            .params-section {
                padding: 15px;
            }

            .params-grid {
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }

            .chart-section {
                padding: 15px;
            }

            #chart {
                height: 300px;
            }

            .metric-value {
                font-size: 1.5rem;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab-btn {
                flex: 1;
                min-width: 80px;
                padding: 12px 10px;
                font-size: 0.85rem;
            }

            th,
            td {
                padding: 10px 8px;
                font-size: 0.85rem;
            }

            .trade-stats {
                flex-wrap: wrap;
                gap: 15px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .params-grid {
                grid-template-columns: 1fr;
            }

            .run-btn {
                padding: 12px 20px;
                font-size: 1rem;
            }

            .card-icon {
                font-size: 1.5rem;
            }

            .card-title {
                font-size: 1.1rem;
            }

            #chart {
                height: 250px;
            }
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .tab-btn {
            padding: 10px 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: #aaa;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #e94560 0%, #ff6b6b 100%);
            border-color: #e94560;
            color: white;
        }

        .trade-stats {
            display: flex;
            gap: 30px;
            margin-bottom: 15px;
            font-size: 0.95rem;
            color: #aaa;
        }

        .trade-stats strong {
            color: #fff;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š ä¸‰ç­–ç•¥æ¯”è¼ƒç³»çµ±</h1>
            <p class="subtitle">èœ˜è››ç¶² vs æ°¸é åšå¤š vs è²·é€²æŒæœ‰</p>
        </header>

        <!-- åƒæ•¸è¨­å®š -->
        <section class="params-section">
            <div class="params-grid">
                <div class="param-group">
                    <label>åˆå§‹è³‡é‡‘</label>
                    <input type="number" id="capital" value="1000000" step="100000">
                </div>
                <div class="param-group">
                    <label>é€†åƒ¹å·®è£œå„Ÿ (%/å¹´)</label>
                    <input type="number" id="backwardation" value="4" step="0.5" min="0" max="8">
                </div>
                <div class="param-group">
                    <label>ğŸ•¸ï¸ èœ˜è››ç¶² f å€¼</label>
                    <input type="number" id="spider_f" value="0.5" step="0.1" min="0.1" max="1.0">
                </div>
                <div class="param-group">
                    <label>ğŸ“ˆ æ°¸é åšå¤šæ§“æ¡¿</label>
                    <input type="number" id="forever_f" value="3.0" step="0.5" min="1.0" max="5.0">
                </div>
                <div class="param-group">
                    <label>ğŸ¦ è²·é€²æŒæœ‰åˆå§‹æ§“æ¡¿</label>
                    <input type="number" id="buyhold_f" value="3.0" step="0.5" min="1.0" max="5.0">
                </div>
            </div>
            <button class="run-btn" onclick="runBacktest()">ğŸš€ åŸ·è¡Œæ¯”è¼ƒå›æ¸¬</button>
        </section>

        <!-- è¼‰å…¥ä¸­ -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>è¨ˆç®—ä¸­ï¼Œè«‹ç¨å€™...</p>
        </div>

        <!-- çµæœå€ -->
        <div id="results" style="display: none;">
            <!-- ç­–ç•¥å¡ç‰‡ -->
            <div class="strategies-grid">
                <div class="strategy-card card-spider">
                    <div class="card-header">
                        <span class="card-icon">ğŸ•¸ï¸</span>
                        <div>
                            <div class="card-title">èœ˜è››ç¶²</div>
                            <div class="card-subtitle">è·Œè²·æ¼²è³£</div>
                        </div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">ç¸½å ±é…¬ç‡</div>
                        <div class="metric-value positive" id="spider-return">+107.05%</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">æœ€çµ‚è³‡é‡‘</div>
                        <div class="metric-value neutral" id="spider-capital">$2,070,491</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">æœ€å¤§å›æ’¤ (MDD)</div>
                        <div class="metric-value negative" id="spider-mdd">14.22%</div>
                    </div>
                    <div class="card-footer" id="spider-params">f=0.5, æ¯æ—¥å†å¹³è¡¡</div>
                </div>

                <div class="strategy-card card-forever">
                    <div class="card-header">
                        <span class="card-icon">ğŸ“ˆ</span>
                        <div>
                            <div class="card-title">æ°¸é åšå¤š</div>
                            <div class="card-subtitle">å†å¹³è¡¡ç¶­æŒæ§“æ¡¿</div>
                        </div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">ç¸½å ±é…¬ç‡</div>
                        <div class="metric-value positive" id="forever-return">+3746.99%</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">æœ€çµ‚è³‡é‡‘</div>
                        <div class="metric-value neutral" id="forever-capital">$38,469,888</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">æœ€å¤§å›æ’¤ (MDD)</div>
                        <div class="metric-value negative" id="forever-mdd">73.75%</div>
                    </div>
                    <div class="card-footer" id="forever-params">f=3.0, æ¯æœˆå†å¹³è¡¡</div>
                </div>

                <div class="strategy-card card-buyhold">
                    <div class="card-header">
                        <span class="card-icon">ğŸ¦</span>
                        <div>
                            <div class="card-title">è²·é€²æŒæœ‰</div>
                            <div class="card-subtitle">ä¸å†å¹³è¡¡</div>
                        </div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">ç¸½å ±é…¬ç‡</div>
                        <div class="metric-value positive" id="buyhold-return">+780.42%</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">æœ€çµ‚è³‡é‡‘</div>
                        <div class="metric-value neutral" id="buyhold-capital">$8,804,186</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">æœ€å¤§å›æ’¤ (MDD)</div>
                        <div class="metric-value negative" id="buyhold-mdd">62.16%</div>
                    </div>
                    <div class="card-footer" id="buyhold-params">åˆå§‹ 3.0x æ§“æ¡¿</div>
                </div>
            </div>

            <!-- åœ–è¡¨ -->
            <section class="chart-section">
                <h3 class="chart-title">ğŸ“ˆ è³‡ç”¢æ›²ç·šæ¯”è¼ƒ</h3>
                <div id="chart"></div>
            </section>

            <!-- è©³ç´°è¡¨æ ¼ -->
            <section class="chart-section">
                <h3 class="chart-title">ğŸ“‹ è©³ç´°æ¯”è¼ƒè¡¨</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ç­–ç•¥</th>
                                <th>æ§“æ¡¿</th>
                                <th>å†å¹³è¡¡</th>
                                <th>ç¸½å ±é…¬ç‡</th>
                                <th>å¹´åŒ–å ±é…¬</th>
                                <th>MDD</th>
                            </tr>
                        </thead>
                        <tbody id="comparison-table">
                            <tr>
                                <td>ğŸ•¸ï¸ èœ˜è››ç¶²</td>
                                <td>0.5x</td>
                                <td>æ¯æ—¥</td>
                                <td style="color: #00d26a;">+107.05%</td>
                                <td>7.12%</td>
                                <td style="color: #e94560;">14.22%</td>
                            </tr>
                            <tr>
                                <td>ğŸ“ˆ æ°¸é åšå¤š</td>
                                <td>3.0x</td>
                                <td>æ¯æœˆ</td>
                                <td style="color: #00d26a;">+3746.99%</td>
                                <td>41.20%</td>
                                <td style="color: #e94560;">73.75%</td>
                            </tr>
                            <tr>
                                <td>ğŸ¦ è²·é€²æŒæœ‰</td>
                                <td>3.0x (åˆå§‹)</td>
                                <td>ä¸å†å¹³è¡¡</td>
                                <td style="color: #00d26a;">+780.42%</td>
                                <td>24.15%</td>
                                <td style="color: #e94560;">62.16%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- äº¤æ˜“æ˜ç´°å€ -->
            <section class="chart-section">
                <h3 class="chart-title">ğŸ“ äº¤æ˜“æ˜ç´°è¨˜éŒ„</h3>
                <div class="tabs">
                    <button class="tab-btn active" onclick="showTradeTab('spider', this)">ğŸ•¸ï¸ èœ˜è››ç¶²</button>
                    <button class="tab-btn" onclick="showTradeTab('forever', this)">ğŸ“ˆ æ°¸é åšå¤š</button>
                    <button class="tab-btn" onclick="showTradeTab('buyhold', this)">ğŸ¦ è²·é€²æŒæœ‰</button>
                </div>
                <div class="trade-stats" id="trade-stats">
                    <span>ç¸½äº¤æ˜“æ¬¡æ•¸: <strong id="stat-trades">0</strong></span>
                    <span>ç´¯è¨ˆè²·é€²: <strong id="stat-buy">0</strong> å£</span>
                    <span>ç´¯è¨ˆè³£å‡º: <strong id="stat-sell">0</strong> å£</span>
                </div>
                <div class="table-container" style="max-height: 400px; overflow-y: auto;">
                    <table id="trade-detail-table">
                        <thead>
                            <tr>
                                <th>æ—¥æœŸ</th>
                                <th>åƒ¹æ ¼</th>
                                <th>éƒ¨ä½</th>
                                <th>è²·è³£</th>
                                <th>è³‡é‡‘</th>
                                <th>é€²å‡ºé‚è¼¯</th>
                            </tr>
                        </thead>
                        <tbody id="trade-detail-body">
                            <tr>
                                <td colspan="6" style="text-align: center; color: #888;">è«‹å…ˆåŸ·è¡Œå›æ¸¬</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- èªªæ˜å€ -->
        <section class="info-section">
            <div class="info-card">
                <h4>ğŸ•¸ï¸ èœ˜è››ç¶²ç­–ç•¥</h4>
                <p>â€¢ f < 1: è·Œè²·æ¼²è³£<br>
                        â€¢ ä¸‹è·Œæ™‚è²·é€²ï¼Œä¸Šæ¼²æ™‚è³£å‡º<br>
                        â€¢ æ”¶å‰²åƒ¹æ ¼æ³¢å‹•çš„æ­£æœŸæœ›å ±é…¬<br>
                        â€¢ é©åˆéœ‡ç›ªå¸‚å ´</p>
            </div>
            <div class="info-card">
                <h4>ğŸ“ˆ æ°¸é åšå¤š</h4>
                <p>â€¢ ç¶­æŒå›ºå®šæ§“æ¡¿<br>
                    â€¢ å®šæœŸå†å¹³è¡¡ç¶­æŒç›®æ¨™æ§“æ¡¿<br>
                    â€¢ ä¸Šæ¼²æ™‚åŠ ç¢¼ï¼Œä¸‹è·Œæ™‚æ¸›ç¢¼<br>
                    â€¢ é©åˆè¶¨å‹¢å¸‚å ´</p>
            </div>
            <div class="info-card">
                <h4>ğŸ¦ è²·é€²æŒæœ‰</h4>
                <p>â€¢ åˆå§‹æ§“æ¡¿å¾Œä¸èª¿æ•´<br>
                    â€¢ æ§“æ¡¿æœƒéš¨åƒ¹æ ¼æ¼‚ç§»<br>
                    â€¢ ä¸Šæ¼²å¾Œæ§“æ¡¿é™ä½<br>
                    â€¢ æœ€ä½äº¤æ˜“æˆæœ¬</p>
            </div>
        </section>
    </div>

    <script>
        const API_URL = 'http://localhost:5001/api/backtest';

        async function runBacktest() {
            // é¡¯ç¤ºè¼‰å…¥
            document.getElementById('loading').classList.add('active');
            document.getElementById('results').style.display = 'none';

            // ç²å–åƒæ•¸
            const params = {
                capital: parseFloat(document.getElementById('capital').value),
                backwardation: parseFloat(document.getElementById('backwardation').value),
                spider_f: parseFloat(document.getElementById('spider_f').value),
                forever_f: parseFloat(document.getElementById('forever_f').value),
                buyhold_f: parseFloat(document.getElementById('buyhold_f').value),
                contract_multiplier: 10  // å¾®å°
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(params)
                });

                const data = await response.json();

                if (data.success) {
                    updateUI(data);
                } else {
                    alert('å›æ¸¬éŒ¯èª¤: ' + data.error);
                }
            } catch (error) {
                alert('ç„¡æ³•é€£æ¥ APIï¼Œè«‹ç¢ºèªå¾Œç«¯å·²å•Ÿå‹• (python api.py)\n\néŒ¯èª¤: ' + error.message);
            }

            document.getElementById('loading').classList.remove('active');
        }

        function updateUI(data) {
            // æ›´æ–°èœ˜è››ç¶²
            document.getElementById('spider-return').textContent = formatPercent(data.spider.return);
            document.getElementById('spider-capital').textContent = formatMoney(data.spider.final_capital);
            document.getElementById('spider-mdd').textContent = formatPercent(data.spider.mdd, false);
            document.getElementById('spider-params').textContent = data.spider.params;

            // æ›´æ–°æ°¸é åšå¤š
            document.getElementById('forever-return').textContent = formatPercent(data.forever.return);
            document.getElementById('forever-capital').textContent = formatMoney(data.forever.final_capital);
            document.getElementById('forever-mdd').textContent = formatPercent(data.forever.mdd, false);
            document.getElementById('forever-params').textContent = data.forever.params;

            // æ›´æ–°è²·é€²æŒæœ‰
            document.getElementById('buyhold-return').textContent = formatPercent(data.buyhold.return);
            document.getElementById('buyhold-capital').textContent = formatMoney(data.buyhold.final_capital);
            document.getElementById('buyhold-mdd').textContent = formatPercent(data.buyhold.mdd, false);
            document.getElementById('buyhold-params').textContent = data.buyhold.params;

            // æ›´æ–°è¡¨æ ¼
            updateTable(data);

            // æ›´æ–°åœ–è¡¨
            const trace1 = {
                x: data.spider.dates,
                y: data.spider.capitals,
                name: 'ğŸ•¸ï¸ èœ˜è››ç¶²',
                line: { color: '#e94560', width: 2 }
            };

            const trace2 = {
                x: data.forever.dates,
                y: data.forever.capitals,
                name: 'ğŸ“ˆ æ°¸é åšå¤š',
                line: { color: '#00d26a', width: 2 }
            };

            const trace3 = {
                x: data.buyhold.dates,
                y: data.buyhold.capitals,
                name: 'ğŸ¦ è²·é€²æŒæœ‰',
                line: { color: '#4a9fff', width: 2 }
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#888', family: 'Inter, sans-serif', size: 14 },
                xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
                yaxis: {
                    gridcolor: 'rgba(255,255,255,0.1)',
                    title: 'è³‡ç”¢åƒ¹å€¼',
                    tickformat: ',.0f'
                },
                legend: {
                    orientation: 'h',
                    y: 1.1,
                    font: { size: 14 }
                },
                margin: { t: 50, b: 50, l: 80, r: 30 }
            };

            Plotly.newPlot('chart', [trace1, trace2, trace3], layout, { responsive: true });

            // å„²å­˜äº¤æ˜“æ˜ç´°ä¸¦é è¨­é¡¯ç¤ºèœ˜è››ç¶²
            currentTradeData = data;
            showTradeTab('spider', document.querySelector('.tab-btn'));

            document.getElementById('results').style.display = 'block';
        }

        function updateTable(data) {
            const tbody = document.getElementById('comparison-table');
            const spider_f = document.getElementById('spider_f').value;
            const forever_f = document.getElementById('forever_f').value;
            const buyhold_f = document.getElementById('buyhold_f').value;

            tbody.innerHTML = `
                <tr>
                    <td>ğŸ•¸ï¸ èœ˜è››ç¶²</td>
                    <td>${spider_f}x</td>
                    <td>æ¯æ—¥</td>
                    <td style="color: #00d26a;">${formatPercent(data.spider.return)}</td>
                    <td>${formatPercent(data.spider.annual_return, false)}</td>
                    <td style="color: #e94560;">${formatPercent(data.spider.mdd, false)}</td>
                </tr>
                <tr>
                    <td>ğŸ“ˆ æ°¸é åšå¤š</td>
                    <td>${forever_f}x</td>
                    <td>æ¯æœˆ</td>
                    <td style="color: #00d26a;">${formatPercent(data.forever.return)}</td>
                    <td>${formatPercent(data.forever.annual_return, false)}</td>
                    <td style="color: #e94560;">${formatPercent(data.forever.mdd, false)}</td>
                </tr>
                <tr>
                    <td>ğŸ¦ è²·é€²æŒæœ‰</td>
                    <td>${buyhold_f}x (åˆå§‹)</td>
                    <td>ä¸å†å¹³è¡¡</td>
                    <td style="color: #00d26a;">${formatPercent(data.buyhold.return)}</td>
                    <td>${formatPercent(data.buyhold.annual_return, false)}</td>
                    <td style="color: #e94560;">${formatPercent(data.buyhold.mdd, false)}</td>
                </tr>
            `;
        }

        function formatPercent(value, showPlus = true) {
            const pct = (value * 100).toFixed(2);
            return showPlus && value >= 0 ? `+${pct}%` : `${pct}%`;
        }

        function formatMoney(value) {
            return '$' + Math.round(value).toLocaleString();
        }

        // äº¤æ˜“æ˜ç´°ç›¸é—œ
        let currentTradeData = null;

        function showTradeTab(strategy, btn) {
            // æ›´æ–° tab ç‹€æ…‹
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');

            if (!currentTradeData) return;

            const data = currentTradeData[strategy];
            if (!data) return;

            // æ›´æ–°çµ±è¨ˆ
            document.getElementById('stat-trades').textContent = data.total_trades.toLocaleString();
            document.getElementById('stat-buy').textContent = data.total_buy.toLocaleString();
            document.getElementById('stat-sell').textContent = data.total_sell.toLocaleString();

            // æ›´æ–°è¡¨æ ¼
            const tbody = document.getElementById('trade-detail-body');
            const details = data.trades_detail || [];

            if (details.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #888;">ç„¡äº¤æ˜“è¨˜éŒ„</td></tr>';
                return;
            }

            // åªé¡¯ç¤ºæœ€è¿‘50ç­†
            const displayDetails = details.slice(-50).reverse();

            tbody.innerHTML = displayDetails.map(t => `
                <tr>
                    <td>${t.date}</td>
                    <td>${t.price.toLocaleString()}</td>
                    <td>${t.volume.toLocaleString()}</td>
                    <td style="color: ${t.trade > 0 ? '#00d26a' : '#e94560'};">${t.trade > 0 ? '+' + t.trade : t.trade}</td>
                    <td>${t.capital.toLocaleString()}</td>
                    <td style="font-size: 0.85rem; color: #888;">${t.reason || '-'}</td>
                </tr>
            `).join('');
        }

        // PWA Service Worker è¨»å†Š
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => console.log('âœ… Service Worker å·²è¨»å†Š'))
                    .catch(err => console.log('âŒ Service Worker è¨»å†Šå¤±æ•—:', err));
            });
        }
    </script>
</body>

</html>